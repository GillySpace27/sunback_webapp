<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solar Archive — Your Sun, Your Day</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="/api/static/solar-archive.css" rel="stylesheet">
</head>
<body>
<div class="app-container">

  <!-- Hero -->
  <div class="hero">
    <div class="hero-icon"></div>
    <h1>Solar Archive</h1>
    <p>See the Sun on any date. Print it on anything.</p>
  </div>

  <!-- CSP Notice (shown only when served from a different origin) -->
  <div class="backend-banner waking hidden" id="cspNotice">
    <span class="banner-icon"><i class="fas fa-shield-alt"></i></span>
    <div class="banner-text">
      <strong>External resource access required</strong>
      <small>If you see a popup asking to "Allow untrusted external resources," please click <strong>Allow All</strong> — the page will reload and the app will work normally.</small>
    </div>
  </div>

  <!-- Backend Status Banner -->
  <div class="backend-banner checking" id="backendBanner">
    <span class="banner-icon"><div class="spinner"></div></span>
    <div class="banner-text">
      <strong>Checking backend status...</strong>
      <small>Connecting to backend...</small>
    </div>
  </div>

  <!-- Step 1: Select Date & Wavelength -->
  <div class="section">
    <div class="section-header">
      <div class="step-badge">1</div>
      <div class="section-title">Choose Your Date &amp; Wavelength</div>
    </div>

    <div class="controls-grid">
      <div class="field-group">
        <span class="field-label">Date</span>
        <input type="date" id="solarDate">
      </div>
      <div class="field-group">
        <span class="field-label">Mission Data</span>
        <select id="missionSelect">
          <option value="SDO">SDO / AIA (2010–present)</option>
        </select>
      </div>
    </div>

    <span class="field-label" style="display:block; margin-top:16px;">Wavelength</span>
    <div class="wavelength-grid" id="wlGrid">
      <div class="wl-card" data-wl="94">
        <div class="wl-thumb" data-wl="94"></div>
        <div class="wl-value">94 Å</div>
        <div class="wl-label">Green · 6.3MK<br>Hot flaring plasma</div>
      </div>
      <div class="wl-card" data-wl="131">
        <div class="wl-thumb" data-wl="131"></div>
        <div class="wl-value">131 Å</div>
        <div class="wl-label">Teal · 10MK<br>Flares / transition</div>
      </div>
      <div class="wl-card selected" data-wl="171">
        <div class="wl-thumb" data-wl="171"></div>
        <div class="wl-value">171 Å</div>
        <div class="wl-label">Golden · 0.8MK<br>Quiet corona, loops</div>
      </div>
      <div class="wl-card" data-wl="193">
        <div class="wl-thumb" data-wl="193"></div>
        <div class="wl-value">193 Å</div>
        <div class="wl-label">Amber · 1.5MK<br>Corona / flares</div>
      </div>
      <div class="wl-card" data-wl="211">
        <div class="wl-thumb" data-wl="211"></div>
        <div class="wl-value">211 Å</div>
        <div class="wl-label">Purple · 2.0MK<br>Active regions</div>
      </div>
      <div class="wl-card" data-wl="304">
        <div class="wl-thumb" data-wl="304"></div>
        <div class="wl-value">304 Å</div>
        <div class="wl-label">Red · 0.05MK<br>Chromosphere</div>
      </div>
      <div class="wl-card" data-wl="335">
        <div class="wl-thumb" data-wl="335"></div>
        <div class="wl-value">335 Å</div>
        <div class="wl-label">Blue · 2.5MK<br>Active regions</div>
      </div>
    </div>

    <button class="btn-generate" id="btnGenerate">
      <i class="fas fa-sun"></i> Generate Preview
    </button>

    <div class="progress-track" id="progressTrack">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="status-msg" id="statusMsg"></div>

    <div class="info-row">
      <i class="fas fa-info-circle"></i>
      <span>AIA imagery available from May 2010. Preview at <a href="https://www.helioviewer.org" target="_blank" rel="noopener">helioviewer.org</a></span>
    </div>
  </div>

  <!-- Step 2: View & Edit Image -->
  <div class="section hidden" id="editSection">
    <div class="section-header">
      <div class="step-badge">2</div>
      <div class="section-title">View &amp; Edit Your Image</div>
    </div>

    <div class="image-stage" id="imageStage">
      <img id="solarImg" alt="Solar image" crossorigin="anonymous">
      <canvas id="solarCanvas"></canvas>
      <div class="crop-overlay hidden" id="cropOverlay"></div>
    </div>

    <!-- Edit Tools -->
    <div class="edit-toolbar">
      <button class="edit-btn" data-tool="crop" title="Crop"><i class="fas fa-crop-alt"></i> Crop</button>
      <button class="edit-btn" data-tool="text" title="Add Text"><i class="fas fa-font"></i> Text</button>
      <button class="edit-btn" data-tool="rotate" title="Rotate 90°"><i class="fas fa-redo"></i> Rotate</button>
      <button class="edit-btn" data-tool="flipH" title="Flip horizontal"><i class="fas fa-arrows-alt-h"></i> Flip H</button>
      <button class="edit-btn" data-tool="flipV" title="Flip vertical"><i class="fas fa-arrows-alt-v"></i> Flip V</button>
      <button class="edit-btn" data-tool="invert" title="Invert colors"><i class="fas fa-adjust"></i> Invert</button>
      <button class="edit-btn" data-tool="reset" title="Reset"><i class="fas fa-undo"></i> Reset</button>
    </div>

    <!-- Text Tool Panel -->
    <div class="text-tool-panel hidden" id="textToolPanel">
      <div class="field-row">
        <span class="field-label-sm">Text</span>
        <input type="text" id="textInput" placeholder="Your text here..." value="">
      </div>
      <div class="field-row">
        <span class="field-label-sm">Size</span>
        <input type="range" id="textSizeSlider" min="12" max="200" value="48" style="flex:1;">
        <span class="slider-val" id="textSizeVal" style="min-width:32px;">48</span>
      </div>
      <div class="field-row">
        <span class="field-label-sm">Font</span>
        <select id="textFontSelect"><!-- populated by JS from FONT_CATALOG --></select>
      </div>
      <div class="field-row">
        <span class="field-label-sm">Color</span>
        <input type="color" id="textColorPicker" value="#ffffff">
        <span class="field-label-sm">Stroke</span>
        <input type="color" id="textStrokePicker" value="#000000">
        <span class="field-label-sm" style="min-width:30px;">W</span>
        <input type="range" id="textStrokeWidth" min="0" max="10" value="2" style="flex:1; max-width:100px;">
        <span class="slider-val" id="textStrokeVal" style="min-width:20px;">2</span>
      </div>
      <div class="field-row text-effect-row">
        <span class="field-label-sm" style="min-width:50px;">Shadow</span>
        <label class="toggle-label"><input type="checkbox" id="textShadowToggle"> On</label>
        <input type="color" id="textShadowColor" value="#000000" title="Shadow color">
        <span class="field-label-sm" style="min-width:24px;">Blur</span>
        <input type="range" id="textShadowBlur" min="0" max="30" value="6" style="flex:1; max-width:80px;">
        <span class="slider-val" id="textShadowBlurVal" style="min-width:20px;">6</span>
      </div>
      <div class="field-row text-effect-row">
        <span class="field-label-sm" style="min-width:50px;">Arc</span>
        <label class="toggle-label"><input type="checkbox" id="textArcToggle"> On</label>
        <span class="field-label-sm" style="min-width:24px;">R</span>
        <input type="range" id="textArcRadius" min="50" max="600" value="200" style="flex:1; max-width:120px;">
        <span class="slider-val" id="textArcRadiusVal" style="min-width:30px;">200</span>
      </div>
      <div class="field-row text-effect-row">
        <span class="field-label-sm" style="min-width:50px;">Outline</span>
        <label class="toggle-label"><input type="checkbox" id="textOutlineToggle"> Stroke only (no fill)</label>
      </div>
      <div style="display:flex; gap:8px; margin-top:6px;">
        <button class="edit-btn" id="applyText" style="flex:1;justify-content:center;">
          <i class="fas fa-check"></i> Burn Text Into Image
        </button>
        <button class="edit-btn" id="cancelText">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
      <div class="text-tool-hint">
        <i class="fas fa-arrows-alt"></i>
        <span>Drag the text on the image to position it. Click "Burn" to permanently apply.</span>
      </div>
    </div>

    <div id="cropControls" class="hidden">
      <div class="crop-ratios">
        <button class="crop-ratio-btn" data-ratio="free">Free</button>
        <button class="crop-ratio-btn active" data-ratio="1:1">1:1</button>
        <button class="crop-ratio-btn" data-ratio="4:3">4:3</button>
        <button class="crop-ratio-btn" data-ratio="3:2">3:2</button>
        <button class="crop-ratio-btn" data-ratio="16:9">16:9</button>
        <button class="crop-ratio-btn product-crop-btn hidden" data-ratio="product" id="cropProductBtn">
          <i class="fas fa-box" style="font-size:10px;"></i> Product
        </button>
      </div>
      <div style="display:flex; gap:8px; margin-top:10px;">
        <button class="edit-btn" id="applyCrop" style="flex:1;justify-content:center;">
          <i class="fas fa-check"></i> Apply Crop
        </button>
        <button class="edit-btn" id="cancelCrop">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>

    <!-- Adjustments -->
    <div class="slider-row">
      <label>Brightness</label>
      <input type="range" id="brightnessSlider" min="-100" max="100" value="0">
      <span class="slider-val" id="brightnessVal">0</span>
    </div>
    <div class="slider-row">
      <label>Contrast</label>
      <input type="range" id="contrastSlider" min="-100" max="100" value="0">
      <span class="slider-val" id="contrastVal">0</span>
    </div>
    <div class="slider-row">
      <label>Saturation</label>
      <input type="range" id="saturationSlider" min="0" max="200" value="100">
      <span class="slider-val" id="saturationVal">100</span>
    </div>
    <div class="slider-row">
      <label>Vignette</label>
      <input type="range" id="vignetteSlider" min="0" max="100" value="16">
      <span class="slider-val" id="vignetteVal">16</span>
    </div>
    <div class="slider-row">
      <label>Vig. Edge</label>
      <input type="range" id="vigWidthSlider" min="0" max="100" value="0">
      <span class="slider-val" id="vigWidthVal">0</span>
    </div>

    <button class="btn-hq hidden" id="btnHQ">
      <i class="fas fa-star"></i> Generate HQ Print-Ready Image
    </button>
  </div>

  <!-- Step 3: Choose Product -->
  <div class="section hidden" id="productSection">
    <div class="section-header">
      <div class="step-badge">3</div>
      <div class="section-title">Choose Your Product</div>
    </div>

    <p style="color:var(--text-secondary);font-size:13px;margin-bottom:12px;">
      Preview how your solar image looks on different products. When you're happy with your edits, click <strong>Buy</strong> on any product to create it on Shopify and complete your purchase.
    </p>

    <div class="product-grid" id="productGrid"></div>

    <button class="btn-catalog" id="btnCatalog">
      <i class="fas fa-th-large"></i> Browse More Products
    </button>

    <div class="mockup-status" id="mockupStatus"></div>

    <!-- Checkout progress (shown when a purchase is in flight) -->
    <div class="checkout-progress hidden" id="checkoutProgress"></div>

    <div class="send-hint" id="sendHint" style="font-size:12px;color:var(--text-dim);margin-top:6px;text-align:center;">
      Generate an image above, then click Buy on any product to purchase.
    </div>

    <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;">
      <button class="btn-secondary" id="btnShopify">
        <i class="fab fa-shopify"></i> Open Shopify Store
      </button>
      <button class="btn-secondary" id="btnPrintifyDash">
        <i class="fas fa-external-link-alt"></i> Printify Dashboard
      </button>
    </div>

    <div class="status-msg" id="orderStatus"></div>
  </div>

  <div class="app-footer">
    Images courtesy of NASA/SDO. Not affiliated; no endorsement implied.<br>
    Powered by <a href="https://solar-archive.onrender.com" target="_blank" rel="noopener">Solar Archive</a>
  </div>
</div>

<!-- Catalog modal (rendered by JS) -->
<div id="catalogModal" class="catalog-modal hidden"></div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script src="/api/static/solar-archive.js"></script>
</body>
</html>
